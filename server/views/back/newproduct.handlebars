<h1 class="font-bold text-3xl text-center p-4">Aggiungi un nuovo Prodotto</h1>

<form id="form" class="flex flex-col p-4 max-w-prose mx-auto gap-4">
  <label for="slug">Slug</label>
  <input
    type="text"
    name="slug"
    id="slug"
    class="dark:bg-neutral-800 rounded"
    required
  />
  <label for="name">Nome</label>
  <input
    type="text"
    name="name"
    id="name"
    class="dark:bg-neutral-800 rounded"
    required
  />
  <label for="animalSlug" class="justify-center">Animale</label>
  <select
    name="animalSlug"
    id="animalSlug"
    class="dark:bg-neutral-800 rounded"
  >
  </select>
  <label for="category">Categoria</label>
  <select
    name="category"
    id="category"
    class="dark:bg-neutral-800 rounded"
    required
  />
  </select>
  <label for="available">Quantità</label>
  <input
    type="number"
    name="available"
    id="available"
    class="dark:bg-neutral-800 rounded" min="1"
    required
  />
  <label for="price">Prezzo</label>
  <input
    type="number"
    name="price"
    id="price"
    class="dark:bg-neutral-800 rounded"
    required
  />
  <label for="text">Descrizione</label>
	<textarea id="text" name="text" class="dark:bg-neutral-800 rounded" rows="5" required></textarea>
  <label for="image">Immagine</label>
  <input type="file" id="image" name="image" accept="image/png, image/jpeg" />
  <button
    type="submit"
    class="p-2 bg-emerald-500 dark:bg-emerald-800 rounded hover:font-bold" onclick="add_product()">
    <span>Aggiungi prodotto</span>
  </button>
</form>
<script>

	fetch('/api/animals')
		.then((response) => response.json())
		.then((animals) => {
			animals.forEach(animal => {
				let option = document.createElement('option');
				option.value = animal._id;
				option.innerHTML = animal.name;
				document.getElementById('animalSlug').appendChild(option);
			});
    });
    	fetch('/api/categories/')
		.then((response) => response.json())
		.then((categories) => {
			categories.forEach(category => {
				let option = document.createElement('option');
				option.value = category._id;
				option.innerHTML = category.name;
				document.getElementById('category').appendChild(option);
			});
    });
    function add_product() {
    fetch('/api/products', {
      method: 'POST',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.token}`
      },
      body: JSON.stringify({
        slug: document.getElementById('slug').value,
        name: document.getElementById('name').value,
        price: document.getElementById('price').value,
        available: document.getElementById('available').value,
        animalId: document.getElementById('animalSlug').value,
        categoryId: document.getElementById('category').value,
        description: document.getElementById('text').value,
        imageUrl: document.getElementById('image').value
      }),
    })
      .then(response => {
        if (response.status == 201){
          window.location.replace('/back/e-commerce');
          return response.json()
        }else
          alert("Si è verificato un errore")

      })
      .catch((error) => {
        console.error('Error:', error);
      });
  }
</script>