<h1 class="text-center text-3xl p-4">Il tuo profilo</h1>
<form id="form" class="flex flex-col p-4 max-w-prose mx-auto gap-4">
	<label for="email">Nome</label>
	<input id="name" class="dark:bg-neutral-800 rounded" type="text" required>
	<label for="surname">Cognome</label>
	<input id="surname" class="dark:bg-neutral-800 rounded" type="text" required>
	<label for="email">Indirizzo e-mail</label>
	<input id="email" class="dark:bg-neutral-800 rounded" type="email" required>
	<label for="address">Indirizzo</label>
	<input id="address" class="dark:bg-neutral-800 rounded" type="text">
	<label for="city">Citt√†</label>
	<input id="city" class="dark:bg-neutral-800 rounded" type="text">
	<input type="submit" class="p-2 bg-emerald-500 dark:bg-emerald-800 rounded hover:font-bold" value="Aggiorna profilo">
</form>
<script>
	if (!localStorage.token) {
		window.location.href = '/front/signin';
	} else {
		document.getElementById('form').onsubmit = update;
		fetch('/api/users/profile/', {
			method: 'GET',
			headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json',
				'Authorization': `Bearer ${localStorage.token}`
			}
		})
			.then(response => response.json())
			.then(data => {
				document.getElementById('name').value = data.name;
				document.getElementById('surname').value = data.surname;
				document.getElementById('email').value = data.email;
				document.getElementById('address').value = data.address || '';
				document.getElementById('city').value = data.city || '';
			});
	}
	function update(event) {
		event.preventDefault();
		fetch('/api/users/profile', {
			method: 'POST',
			headers: {
				'Accept': 'application/json',
				'Content-Type': 'application/json',
				'Authorization': `Bearer ${localStorage.token}`				
			},
			body: JSON.stringify({
				name: document.getElementById('name').value,
				surname: document.getElementById('surname').value,
				email: document.getElementById('email').value,
				address: document.getElementById('address').value,
				city: document.getElementById('city').value,
			}),
		})
			.then((response) => {
				if (response.ok) {
					alert('Profilo aggiornato');
					window.location.reload();
				}
			})
			.catch((error) => {
				console.error('Error:', error);
			});
	}
</script>
