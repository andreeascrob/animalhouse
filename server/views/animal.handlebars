<div id="products" class="flex flex-col gap-4 p-4 max-w-screen-lg mx-auto">
</div>
<div class="flex flex-row flex-wrap gap-4 justify-around max-w-screen-lg mx-auto">
	<a href="" class="flex flex-row gap-2 rounded p-4 bg-emerald-500 dark:bg-emerald-800 justify-center items-center w-52 hover:font-bold">
		<img class="dark:invert" width="20" src="/icons/chat.svg">
		<span>Comunit√†<span>
	</a>
	<a href="" class="flex flex-row gap-2 rounded p-4 bg-emerald-500 dark:bg-emerald-800 justify-center items-center w-52 hover:font-bold">
		<img class="dark:invert" width="20" src="/icons/house-medical.svg">
		<span>Servizi in presenza<span>
	</a>
	<a href="" class="flex flex-row gap-2 rounded p-4 bg-emerald-500 dark:bg-emerald-800 justify-center items-center w-52 hover:font-bold">
		<img class="dark:invert" width="20" src="/icons/globe.svg">
		<span>Servizi online<span>
	</a>
</div>
<script>
	fetch('/api/animals/' + window.location.pathname.match(/[^\/]+(?=\/?$)/)[0])
		.then((response) => response.json())
		.then((animal) => {
			fetch('/api/categories/')
				.then((response) => response.json())
				.then((categories) => {
					categories.forEach(category => {
						fetch('/api/products/?animalId=' + animal._id + '&categoryId=' + category._id)
							.then((response) => response.json())
							.then((products) => {
								if (products.length > 0) {
									let categoryHeader = document.createElement('h2');
									categoryHeader.innerText = category.name;
									categoryHeader.classList = 'text-3xl font-bold';
									document.getElementById('products').appendChild(categoryHeader);
									let categoryDiv = document.createElement('div');
									// categoryDiv.classList = 'grid grid-cols-1 md:grid-cols-3 gap-4 p-4 max-w-screen-lg mx-auto';
									categoryDiv.classList = 'flex flex-row flex-nowrap w-full gap-4 p-4 max-w-screen-lg mx-auto overflow-x-scroll snap-x';
									categoryDiv.id = category.slug;
									document.getElementById('products').appendChild(categoryDiv);
								}
								products.forEach(productData => {
									let productCard = document.createElement('ah-productcard');
									productCard.setAttribute('productname', productData.name);
									productCard.setAttribute('price', productData.price);
									productCard.setAttribute('url', '/front/product/' + productData.slug);
									productCard.setAttribute('image', productData.imageUrl);
									document.getElementById(category.slug).appendChild(productCard);
								});
							});
					});
				});
		});
</script>
